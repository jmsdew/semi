<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>학교 종이 땡땡땡</title>
    <link rel="stylesheet" href="/css/global.css" type="text/css">
    <link rel="stylesheet" href="/css/rank.css" type="text/css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.0/font/bootstrap-icons.css">
</head>
<body>
<div class="pyro">
    <div class="before"></div>
    <div class="after"></div>
</div>
<header class="navbox">
    <nav>
        <h1>
            <button class="main">
                <a href="main">학교종이 땡땡땡</a>
            </button>
        </h1>
        <ul>
            <li>
                <button class="ranking" onclick="location.href='rank'">
                    랭킹
                </button>
            </li>
            <li>
                <button class="calendar" onclick="location.href='calendar'">
                    캘린더
                </button>
            </li>
            <li>
                <button class="student-management" onclick="location.href='management'">
                    학생관리
                </button>
            </li>
            <li>
                <button class="mypage">
                    <a href="#">마이페이지</a>
                </button>
            </li>
        </ul>
    </nav>
</header>
<article class="rank">
    <!---------------------------반 랭킹-------------------------------------->
    <div class="rank-total">
        <div class="rank-main">
            <div class="rank-main-1"><div class="tema-name" th:text="${tema}"></div></div>
            <div class="category-button"><button class="category-button-1" id="popupClick">테마</button></div>
            <div class="student-button"><button class="student-button-1">학생</button></div>
        </div>
        <div class="ranking-page">
            <div class="ranking-page-1">등수 <br>
                <p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p>
            </div>
            <div class="ranking-page-2">이름</div>
            <div class="ranking-page-3">점수</div>
        </div>
        <div class="studenttb">
            <table id="studenttb">
                <tr th:each="student : ${students}">   <!--foreach 문 표현식-->
                    <td style="background-color: white">
                        <!-- 버튼 클릭 시 JavaScript 함수 호출 -->
                        <button th:text="${student.name}"
                                th:value="${student.name}"
                                th:data-student-name="${student.name}"
                                th:data-tema="${tema}"
                                onclick="sendStudentName(this)"
                                style="background-color: white;
                           font-size : 40px;
                           border : none;
                           left: 50px;
                           cursor: pointer;
                         "></button></td>
                    <td th:text="${student.score}" style="background-color: white"></td>
                </tr>
            </table>
        </div>
    </div>

    <div class="popup">
        <div class="popup-div">
            <button class="popup1-button" onclick="fetchData('배려')">배려</button>
            <button class="popup1-button" onclick="fetchData('사교')">사교</button>
            <button class="popup1-button" onclick="fetchData('긍정')">긍정</button>
            <button class="popup1-button" onclick="fetchData('책임')">책임</button>
            <button class="popup1-button" onclick="fetchData('성실')">성실</button>
            <button class="popup1-button" onclick="fetchData('도움')">도움</button>
            <button class="popup1-button" onclick="fetchData('예의')">예의</button>
            <button class="popup1-button" onclick="fetchData('봉사')">봉사</button>
            <button class="popup1-button" onclick="fetchData('리더십')">리더십</button>
            <button class="popup1-button" onclick="fetchData('끈기')">끈기</button>
        </div>
    </div>
    <!-----------------------------테마별 1등---------------------------------------->
    <div class="rank-winner">
        <div class="rank-box">칭찬 받은 내용</div>
        <div class="rank-winner-1">
            <table id="ranktb">
                <tr th:each="rank1 : ${rankReason}">   <!--foreach 문 표현식-->
                    <td><i class="bi bi-trophy" id="trophy"></i> </td>
                    <td th:text="${rank1.point}" style="background-color: white"></td>
                    <td th:text="${rank1.reason}" style="background-color: white"></td>
                    <td th:text="${rank1.date}" style="background-color: white"></td>
                </tr>
            </table>
        </div>
    </div>
    <!---------------------------------랭킹단상------------------------------------->
    <div class="rank-platform">
        <div class="first-rank">
            <table>
                <tr th:each="top : ${first}">
                    <td th:text="${top.name}" style="background-color: #FFE150"></td>
                </tr>
            </table>
        </div>
        <div class="second-rank">
            <table>
                <tr th:each="second : ${second}">
                    <td th:text="${second.name}" style="background-color: #FFE150"></td>
                </tr>
            </table>
        </div>
        <div class="third-rank">
            <table>
                <tr th:each="third : ${third}">
                    <td th:text="${third.name}" style="background-color: #FFE150"></td>
                </tr>
            </table>
        </div>

    </div>
</article>

<script>

    // 학생 이름을 서버로 전송하는 함수
    function sendStudentName(button) {
        // 선택된 버튼에서 데이터 속성(data-student-name)을 읽어옴
        let studentName = button.getAttribute("data-student-name");
        let tema = button.getAttribute("data-tema");

        // Fetch API를 사용하여 서버로 데이터 전송
        fetch("/user/temaRank", {
            method: 'POST', // HTTP POST 요청
            headers: {
                'Content-Type': 'application/json', // JSON 형태의 데이터 전송을 지정
            },
            body: JSON.stringify({ studentName: studentName , tema: tema}), // JSON 형태로 데이터 변환
        })
            .then(response => response.json()) // 서버 응답을 JSON으로 파싱
            .then(data => {
                console.log("서버 응답:", data);
            })
            .catch(error => {
                console.error("에러 발생:", error);
            });
    }

    function fetchData(keyword) {
        fetch(`/your-endpoint/${keyword}`, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
            },
        })
            .then(response => response.json())
            .then(data => {
                // 받은 데이터를 처리
                console.log(data);

            })
            .catch(error => {
                console.error('Error:', error);
            });
    }



    document.getElementById('popupClick').addEventListener('click', function(event) {
        let popup = document.querySelector('.popup');

        // 마우스 클릭 이벤트의 발생 위치를 가져옴
        let mouseX = event.pageX;
        let mouseY = event.pageY;

        // 팝업을 마우스 클릭 위치 옆에 표시 (예: 오른쪽 10px, 아래 10px)
        popup.style.left = (mouseX + 40) + 'px';
        popup.style.top = (mouseY + 20) + 'px';

        // 팝업을 보이도록 설정
        popup.style.display = 'block';
    });

    document.addEventListener('click', function (event) {
        let popup = document.querySelector('.popup');

        // 팝업 외부를 클릭하거나 팝업 자체를 클릭하지 않았을 때 팝업을 숨김
        if (event.target !== popup && !popup.contains(event.target) && event.target !== document.getElementById('popupClick')) {
            popup.style.display = 'none';
        }
    });
</script>
</body>
</html>
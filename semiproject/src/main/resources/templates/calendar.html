<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>학교 종이 땡땡땡</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <!-- jquery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!-- bootstrap 4 -->
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

    <!-- fullcalendar -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@5.7.0/main.min.css">
    <link rel="stylesheet" href="/css/calendar.css">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/fullcalendar@5.7.0/main.min.js"></script>


    <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', function () {
            let calendarEl = document.getElementById('calendar');
            let calendar = new FullCalendar.Calendar(calendarEl, {
                timeZone: 'UTC',
                initialView: 'dayGridMonth', // 홈페이지에서 다른 형태의 view를 확인할  수 있다.
                events:[ // 일정 데이터 추가 , DB의 event를 가져오려면 JSON 형식으로 변환해 events에 넣어주면된다.
                    {
                        title:'일정',
                        start:'2021-05-26 00:00:00',
                        end:'2021-05-27 24:00:00'
                        // color 값을 추가해 색상도 변경 가능 자세한 내용은 하단의 사이트 참조
                    }
                ], headerToolbar: {
                    center: 'addEventButton' // headerToolbar에 버튼을 추가
                }, customButtons: {
                    addEventButton: { // 추가한 버튼 설정
                        text : "일정 추가",  // 버튼 내용
                        click : function(){ // 버튼 클릭 시 이벤트 추가
                            $("#calendarModal").modal("show"); // modal 나타내기

                            $("#addCalendar").on("click",function(){  // modal의 추가 버튼 클릭 시
                                let content = $("#calendar_content").val();
                                let start_date = $("#calendar_start_date").val();
                                let end_date = $("#calendar_end_date").val();

                                //내용 입력 여부 확인
                                if(content == null || content == ""){
                                    alert("내용을 입력하세요.");
                                }else if(start_date == "" || end_date ==""){
                                    alert("날짜를 입력하세요.");
                                }else if(new Date(end_date)- new Date(start_date) < 0){ // date 타입으로 변경 후 확인
                                    alert("종료일이 시작일보다 먼저입니다.");
                                }else{ // 정상적인 입력 시
                                    let obj = {
                                        "title" : content,
                                        "start" : start_date,
                                        "end" : end_date
                                    }//전송할 객체 생성

                                    console.log(obj); //서버로 해당 객체를 전달해서 DB 연동 가능
                                }
                            });
                        }
                    }
                },
                editable: true, // false로 변경 시 draggable 작동 x
                displayEventTime: false // 시간 표시 x
            });
            calendar.render();
        });
    </script>
</head>
<body>
<!--------------------------------------제목 및 네비----------------------------------------------->
<header class="navbox">
    <nav>
        <h1>
            <button class="main" onclick="location.href='main'">
                학교종이 땡땡땡
            </button>
        </h1>
        <ul>
            <li>
                <button class="ranking" onclick="location.href='rank'">
                    랭킹
                </button>
            </li>
            <li>
                <button class="calendar" onclick="location.href='calendar'">
                    캘린더
                </button>
            </li>
            <li>
                <button class="student-management" onclick="location.href='management'">
                    학생관리
                </button>
            </li>
            <li>
                <button class="mypage">
                    <a href="#">마이페이지</a>
                </button>
            </li>
        </ul>
    </nav>
</header>
<!----------------------------------------캘린더---------------------------------------->
    <div class="schedule">
        <div class="schedule-1">
            <h2>오늘의 일정</h2>
            <div class="scheduletb">
                <table id="scheduletb">
                    <tr th:each="schedules : ${schedule}">   <!--foreach 문 표현식-->
                        <td th:text="${schedules.name}" style="background-color: white"></td>
                    </tr>
                </table>
            </div>
        </div>

        <div id="calendarBox">
            <div id="calendar"></div>
        </div>

        <!-- modal 추가 -->
        <div class="modal fade" id="calendarModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
             aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">일정을 입력하세요.</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label class="col-form-label">일정 내용</label>
                            <input type="text" class="form-control" id="calendar_content" name="calendar_content">
                            <label class="col-form-label">시작 날짜</label>
                            <input type="date" class="form-control" id="calendar_start_date" name="calendar_start_date">
                            <label class="col-form-label">종료 날짜</label>
                            <input type="date" class="form-control" id="calendar_end_date" name="calendar_end_date">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-warning" id="addCalendar">추가</button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal"
                                id="sprintSettingModalClose">취소</button>
                    </div>

                </div>
            </div>
        </div>



        <div class="popup">
            <div class="popup-div">
                <h2>일정 등록</h2>
                <form action="date-scheduel">
                    일정 이름 : <input type="text" id="name"/>
                    날짜 : <input type="date" id="date"/>
                    일정 내용 : <input type="text" id="content"/>
                    <button type="submit">등록</button>
                </form>
            </div>
        </div>
    </div>


    <footer id=footers>
        <div id = email>kbjcom@google.com</div>

        <img src="image/bell.png" alt="school Bell" id="bell">
        <div id =footerTitle>학교 종이 땡땡땡</div>

        <div id="number">call : 010-6411-9074</div>
        <div id="footerFinal">
            <div>Copyright (C) 2023</div>
            <div id="jejuH">.김백정컴퍼니.</div>
            <div>All rights reserved.</div>
        </div>
    </footer>



 <script>
     $(document).ready(function() {
         calendarInit();
     });
     function calendarInit() {

         // 날짜 정보 가져오기
         let date = new Date(); // 현재 날짜(로컬 기준) 가져오기
         let utc = date.getTime() + (date.getTimezoneOffset() * 60 * 1000); // uct 표준시 도출
         let kstGap = 9 * 60 * 60 * 1000; // 한국 kst 기준시간 더하기
         let today = new Date(utc + kstGap); // 한국 시간으로 date 객체 만들기(오늘)

         let thisMonth = new Date(today.getFullYear(), today.getMonth(), today.getDate());
         // 달력에서 표기하는 날짜 객체


         let currentYear = thisMonth.getFullYear(); // 달력에서 표기하는 연
         let currentMonth = thisMonth.getMonth(); // 달력에서 표기하는 월
         let currentDate = thisMonth.getDate(); // 달력에서 표기하는 일

         // kst 기준 현재시간
         // console.log(thisMonth);

         // 캘린더 렌더링
         renderCalender(thisMonth);

         function renderCalender(thisMonth) {

             // 렌더링을 위한 데이터 정리
             currentYear = thisMonth.getFullYear();
             currentMonth = thisMonth.getMonth();
             currentDate = thisMonth.getDate();

             // 이전 달의 마지막 날 날짜와 요일 구하기
             let startDay = new Date(currentYear, currentMonth, 0);
             let prevDate = startDay.getDate();
             let prevDay = startDay.getDay();

             // 이번 달의 마지막날 날짜와 요일 구하기
             let endDay = new Date(currentYear, currentMonth + 1, 0);
             let nextDate = endDay.getDate();
             let nextDay = endDay.getDay();

             // console.log(prevDate, prevDay, nextDate, nextDay);

             // 현재 월 표기
             $('.year-month').text(currentYear + '.' + (currentMonth + 1));

             // 렌더링 html 요소 생성
             calendar = document.querySelector('.dates')
             calendar.innerHTML = '';

             // 지난달
             for (let i = prevDate - prevDay + 1; i <= prevDate; i++) {
                 calendar.innerHTML = calendar.innerHTML + '<div class="day prev disable">' + i + '</div>'
             }
             // 이번달
             for (let i = 1; i <= nextDate; i++) {
                 calendar.innerHTML = calendar.innerHTML + '<div class="day current">' + i + '</div>'
             }
             // 다음달
             for (let i = 1; i <= (7 - nextDay == 7 ? 0 : 7 - nextDay); i++) {
                 calendar.innerHTML = calendar.innerHTML + '<div class="day next disable">' + i + '</div>'
             }

             // 오늘 날짜 표기
             if (today.getMonth() == currentMonth) {
                 todayDate = today.getDate();
                 let currentMonthDate = document.querySelectorAll('.dates .current');
                 currentMonthDate[todayDate -1].classList.add('today');
             }
         }

         // 이전달로 이동
         $('.go-prev').on('click', function() {
             thisMonth = new Date(currentYear, currentMonth - 1, 1);
             renderCalender(thisMonth);
         });

         // 다음달로 이동
         $('.go-next').on('click', function() {
             thisMonth = new Date(currentYear, currentMonth + 1, 1);
             renderCalender(thisMonth);
         });
     }

     document.getElementById('popupClick').addEventListener('click', function() {
         document.querySelector('.popup').style.display = 'block';
     });

     document.addEventListener('click', function (event) {
         if (event.target !== document.querySelector('.popup') && !document.querySelector('.popup').contains(event.target) && event.target !== document.getElementById('popupClick')) {
             document.querySelector('.popup').style.display = 'none';
         }
     });
 </script>
</body>
</html>